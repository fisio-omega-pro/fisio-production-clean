<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configuración FisioTool | Setup</title>
    <!-- FUENTES CROPE -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100&family=Muli:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900&display=swap" rel="stylesheet">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">

    <style>
        /* ================= CROPE DESIGN SYSTEM ================= */
        :root {
            --bg-dark: #121318;
            --bg-card: #191c26;
            --bg-input: #111319;
            --accent: #DD4242; /* Crope Red */
            --text-main: #FFFFFF;
            --text-muted: #A9AFC3;
            --border-color: #393f4f;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-main);
            height: 100vh;
            overflow-x: hidden;
            display: flex;
            align-items: center;
            margin: 0;
        }

        /* Estructura */
        .wrapper { width: 100%; max-width: 1400px; margin: 0 auto; padding: 20px; }
        .setup-container { display: flex; align-items: stretch; min-height: 80vh; background: var(--bg-card); box-shadow: 0 0 50px rgba(0,0,0,0.5); overflow: hidden; position: relative; }
        
        /* Izquierda Visual */
        .info-side {
            background-image: url('https://via.placeholder.com/600x1200'); /* Imagen estilo Crope oscura */
            background-size: cover;
            position: relative;
            padding: 60px 40px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            color: #fff;
            z-index: 1;
        }
        .info-side::before {
            content:''; position: absolute; top:0; left:0; width: 100%; height: 100%;
            background: linear-gradient(180deg, rgba(18, 19, 24, 0.8) 0%, rgba(221, 66, 66, 0.2) 100%);
            z-index: -1;
        }

        .page-number-bg {
            font-size: 150px; font-weight: 700; color: rgba(255,255,255,0.05);
            position: absolute; bottom: -40px; right: -20px; line-height: 1;
            transition: all 0.5s ease;
        }

        /* Formulario Derecha */
        .form-side { padding: 60px 50px; background-color: var(--bg-card); position: relative; overflow-y: auto; max-height: 80vh; }
        
        /* Typography */
        h1 { font-size: 36px; font-weight: 700; margin-bottom: 10px; line-height: 1.1; }
        h1 span { color: var(--accent); position: relative; }
        h1 span::after { content: ''; position: absolute; width: 10px; height: 10px; background: var(--accent); border-radius: 50%; bottom: 5px; right: -15px; }
        h3 { font-size: 20px; text-transform: uppercase; letter-spacing: 2px; color: var(--text-muted); margin-bottom: 30px; font-family: 'Muli'; font-weight: 700; }
        
        /* Inputs Crope Style */
        .form-group label { display: block; font-size: 12px; text-transform: uppercase; color: var(--accent); margin-bottom: 5px; letter-spacing: 1px; font-weight: 600;}
        .custom-input {
            width: 100%; background: transparent; border: none; border-bottom: 1px solid var(--border-color);
            padding: 10px 0; color: #fff; font-size: 16px; font-family: 'Muli'; transition: 0.3s;
        }
        .custom-input:focus { border-color: var(--accent); outline: none; }
        
        /* Referral Box */
        .referral-box {
            background: rgba(221, 66, 66, 0.1); border-left: 2px solid var(--accent);
            padding: 20px; margin-bottom: 40px; display: flex; align-items: center; justify-content: space-between;
        }
        .referral-input { background: transparent; border: 1px solid var(--border-color); color: #fff; text-align: center; padding: 5px; text-transform: uppercase; font-weight: bold; width: 120px; }

        /* Pasos (Wizard) */
        .step { display: none; opacity: 0; transform: translateY(20px); transition: all 0.5s ease; }
        .step.active { display: block; opacity: 1; transform: translateY(0); animation: slideUp 0.6s ease forwards; }
        @keyframes slideUp { from{opacity:0;transform:translateY(20px);} to{opacity:1;transform:translateY(0);} }

        /* Botones */
        .btn-default {
            background: transparent; border: 2px solid #fff; color: #fff;
            padding: 12px 40px; border-radius: 50px; text-transform: uppercase; font-weight: 600; font-size: 14px;
            cursor: pointer; transition: 0.4s;
        }
        .btn-default:hover { background: #fff; color: #000; }
        
        .btn-next { background: var(--accent); border-color: var(--accent); float: right;}
        .btn-next:hover { background: transparent; color: var(--accent); }

        .btn-prev { color: var(--text-muted); border-color: var(--border-color); }
        .btn-prev:hover { border-color: #fff; color: #fff; background: transparent; }

        /* Upload Box */
        .upload-box {
            border: 2px dashed var(--border-color); padding: 50px 20px; text-align: center;
            cursor: pointer; transition: 0.3s; background: rgba(0,0,0,0.2);
        }
        .upload-box:hover { border-color: var(--accent); background: rgba(221,66,66,0.05); }
        .upload-box svg { fill: var(--text-muted); width: 40px; margin-bottom: 15px; transition: 0.3s;}
        .upload-box:hover svg { fill: var(--accent); }

        /* Tags / Red Flags */
        .checkbox-grid { display: flex; flex-wrap: wrap; gap: 10px; }
        .tag-check input { display: none; }
        .tag-check span {
            display: inline-block; padding: 8px 20px; background: var(--bg-input); 
            border: 1px solid var(--border-color); color: var(--text-muted); cursor: pointer;
            text-transform: uppercase; font-size: 12px; transition: 0.3s; font-family: 'Muli';
        }
        .tag-check input:checked + span {
            border-color: var(--accent); background: var(--accent); color: #fff;
        }

        /* Responsive */
        @media (max-width: 991px) {
            .info-side { display: none; } /* En móvil simplificamos ocultando la deco */
            .setup-container { min-height: 100vh; border-radius: 0; }
        }
        
    </style>
</head>
<body>

    <div class="wrapper">
        <div class="row no-gutters setup-container">
            
            <!-- Left Info Panel -->
            <div class="col-lg-5 info-side">
                <div>
                    <img src="images/logo.png" alt="FisioTool Logo" style="width: 120px; margin-bottom: 40px; opacity: 0.8;"> <!-- Si no hay imagen, poner texto -->
                    <h1>Configuración <br><span>Inicial</span></h1>
                    <p style="font-family: 'Muli'; color: #A9AFC3; margin-top: 20px; line-height: 1.7;">
                        Bienvenido a la nueva era de gestión clínica. Vamos a configurar tu entorno neural en 4 sencillos pasos.
                    </p>
                </div>

                <div class="wizard-status">
                    <p style="text-transform: uppercase; letter-spacing: 2px; font-size: 12px; color: var(--accent); margin-bottom: 10px;">Progreso del Alta</p>
                    <div class="progress" style="height: 4px; background: #2a2e3d;">
                        <div class="progress-bar" id="progressBar" style="width: 25%; background: var(--accent);"></div>
                    </div>
                </div>

                <div class="page-number-bg" id="bgNumber">01</div>
            </div>

            <!-- Right Form Panel -->
            <div class="col-lg-7 form-side">
                
                <!-- STEP 1 -->
                <div id="step1" class="step active">
                    <h3>01. Datos Corporativos</h3>
                    
                    <!-- Referral -->
                    <div class="referral-box">
                        <div>
                            <span style="display:block; color: #fff; font-weight:600;">¿Código de Invitado?</span>
                            <small style="color: var(--text-muted); font-family: 'Muli'">Desbloquea funciones PRO + 50% Dto.</small>
                        </div>
                        <input type="text" id="referral_code" class="referral-input" placeholder="CODE">
                    </div>

                    <form id="setup-form">
                        <div class="form-group mb-5">
                            <label>Nombre Comercial de la Clínica</label>
                            <input type="text" id="clinic_name" class="custom-input" placeholder="Ej: Clínica Neural Fisio" required>
                        </div>

                        <div class="row">
                            <div class="col-8">
                                <div class="form-group mb-4">
                                    <label>Dirección Fiscal</label>
                                    <input type="text" id="addr_street" class="custom-input" placeholder="Calle / Avda / Plaza">
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="form-group mb-4">
                                    <label>Número</label>
                                    <input type="text" id="addr_num" class="custom-input" placeholder="Nº">
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-4">
                                <div class="form-group mb-4">
                                    <label>Piso/Puerta</label>
                                    <input type="text" id="addr_floor" class="custom-input">
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="form-group mb-4">
                                    <label>CP</label>
                                    <input type="text" id="addr_cp" class="custom-input">
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="form-group mb-4">
                                    <label>Ciudad</label>
                                    <input type="text" id="addr_city" class="custom-input">
                                </div>
                            </div>
                        </div>

                        <div class="form-group mb-5">
                            <label>Provincia / Estado</label>
                            <input type="text" id="addr_prov" class="custom-input">
                        </div>

                        <div class="form-group mb-5" style="border-left: 2px solid #4ECDC4; padding-left: 20px;">
                            <label style="color: #4ECDC4">Smartphone Vinculado (API Meta/WhatsApp)</label>
                            <input type="tel" id="meta_phone" class="custom-input" placeholder="+34 000 000 000">
                            <small style="color:#A9AFC3; display:block; margin-top:5px;">Número donde operará la IA 'Ana' para citas.</small>
                        </div>

                        <div class="clearfix mt-5">
                            <button type="button" class="btn-default btn-next" onclick="goStep(2)">Siguiente Paso</button>
                        </div>
                    </form>
                </div>

                <!-- STEP 2 -->
                <div id="step2" class="step">
                    <h3>02. Migración de Pacientes</h3>
                    <p style="color: #A9AFC3; font-family:'Muli'; margin-bottom: 30px;">
                        Importa tu base de datos antigua para entrenar al algoritmo desde el día 1. Aceptamos CSV, XLS.
                    </p>

                    <div class="upload-box" onclick="document.getElementById('csv_file').click()">
                        <svg viewBox="0 0 24 24"><path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z"/></svg>
                        <h4 style="color:#fff; font-size: 18px;">Click para subir Base de Datos</h4>
                        <span style="color: #555; font-size: 14px;">(Datos encriptados E2EE)</span>
                        <input type="file" id="csv_file" hidden>
                    </div>

                    <div class="clearfix mt-5">
                        <button type="button" class="btn-default btn-prev" onclick="goStep(1)">Atrás</button>
                        <button type="button" class="btn-default btn-next" onclick="goStep(3)">Siguiente Paso</button>
                    </div>
                </div>

                <!-- STEP 3 -->
                <div id="step3" class="step">
                    <h3>03. Modelo Económico</h3>
                    
                    <div class="row">
                        <div class="col-6">
                            <div class="form-group mb-4">
                                <label>Tarifa Estándar (€)</label>
                                <input type="number" id="price" class="custom-input" value="50">
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="form-group mb-4">
                                <label>Duración Sesión (min)</label>
                                <select id="duration" class="custom-input" style="color: #A9AFC3; border-radius:0;">
                                    <option value="30">30 Min</option>
                                    <option value="45" selected>45 Min</option>
                                    <option value="60">60 Min</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="form-group mb-5">
                        <label class="mb-3">Métodos de Cobro en Clínica</label>
                        <div class="checkbox-grid">
                            <label class="tag-check">
                                <input type="checkbox" class="pay-method" value="Efectivo" checked>
                                <span>Efectivo</span>
                            </label>
                            <label class="tag-check">
                                <input type="checkbox" class="pay-method" value="Tarjeta" checked>
                                <span>Tarjeta / Datáfono</span>
                            </label>
                            <label class="tag-check">
                                <input type="checkbox" class="pay-method" value="Bizum">
                                <span>Bizum</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group p-4" style="background: rgba(221,66,66,0.05); border: 1px solid var(--accent);">
                        <label style="color: var(--accent);"><i class="fas fa-shield-alt"></i> Fianza Anti-No-Show</label>
                        <input type="number" id="deposit" class="custom-input" placeholder="Ej: 20 (€)" style="margin-bottom:5px;">
                        <small style="color:#A9AFC3; font-family:'Muli'">Importe que la IA cobrará online antes de confirmar para evitar huecos vacíos.</small>
                    </div>

                    <div class="clearfix mt-5">
                        <button type="button" class="btn-default btn-prev" onclick="goStep(2)">Atrás</button>
                        <button type="button" class="btn-default btn-next" onclick="goStep(4)">Siguiente Paso</button>
                    </div>
                </div>

                <!-- STEP 4 -->
                <div id="step4" class="step">
                    <h3>04. Filtros de IA & Seguridad</h3>
                    
                    <div class="form-group mb-5">
                        <label class="mb-3" style="color:var(--accent)">⛔ Red Flags (Rechazo Automático IA)</label>
                        <p style="font-family:'Muli'; font-size:14px; color:var(--text-muted);">Selecciona los casos que "Ana" (tu IA) no debe agendar bajo ningún concepto:</p>
                        
                        <div class="checkbox-grid red-flag-zone">
                            <label class="tag-check"><input type="checkbox" class="redflag" value="trafico"><span>Accidentes Tráfico</span></label>
                            <label class="tag-check"><input type="checkbox" class="redflag" value="neurologia"><span>Neurología</span></label>
                            <label class="tag-check"><input type="checkbox" class="redflag" value="suelo_pelvico"><span>Suelo Pélvico</span></label>
                            <label class="tag-check"><input type="checkbox" class="redflag" value="pediatria"><span>Pediatría</span></label>
                            <label class="tag-check"><input type="checkbox" class="redflag" value="respiratorio"><span>Respiratorio</span></label>
                            <label class="tag-check"><input type="checkbox" class="redflag" value="seguros"><span>Mutuas / Seguros</span></label>
                        </div>
                    </div>

                    <div style="border-top: 1px solid var(--border-color); padding-top: 30px; margin-top:30px;">
                        <p style="color: #fff; font-size:16px;">
                            <strong>Todo listo.</strong> Al finalizar, conectarás con la pasarela bancaria segura (Stripe) para activar tu licencia.
                        </p>
                    </div>

                    <div class="clearfix mt-5">
                        <button type="button" class="btn-default btn-prev" onclick="goStep(3)">Atrás</button>
                        <button type="button" class="btn-default btn-next" style="background-color: var(--accent); color:#fff; border:none;" onclick="saveAndGoToPayment()">
                            GUARDAR Y PAGAR
                        </button>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- PRELOADER -->
    <div class="preloader" style="position:fixed; top:0;left:0; width:100%; height:100%; background:#000; z-index:9999; display:none; align-items:center; justify-content:center;">
        <div style="text-align:center;">
            <img src="images/loader.gif" alt=""> <!-- Asumiendo existencia, o spinner CSS -->
            <h2 style="color:#fff; font-family:'Poppins'; margin-top:20px; font-weight:700;">GUARDANDO SISTEMA...</h2>
        </div>
    </div>

    <!-- SCRIPT ORIGINAL LOGIC (INTACTO) + VISUAL LOGIC -->
    <script>
        function goStep(n) {
            // Logic CSS visual
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            document.getElementById('step'+n).classList.add('active');
            
            // Progress bar
            let width = n * 25;
            document.getElementById('progressBar').style.width = width + '%';

            // Background number change (Visual candy)
            document.getElementById('bgNumber').innerText = '0' + n;
        }

        async function saveAndGoToPayment() {
            // Efecto Preloader Estilo Crope
            const preloader = document.querySelector('.preloader');
            preloader.style.display = 'flex';

            // Recopilar Dirección Completa (Lógica original mantenida)
            const fullAddress = {
                calle: document.getElementById('addr_street').value,
                numero: document.getElementById('addr_num').value,
                piso: document.getElementById('addr_floor').value,
                cp: document.getElementById('addr_cp').value,
                ciudad: document.getElementById('addr_city').value,
                provincia: document.getElementById('addr_prov').value
            };

            const data = {
                clinica: document.getElementById('clinic_name').value,
                direccion_completa: fullAddress, 
                telefono_meta: document.getElementById('meta_phone').value,
                precio: document.getElementById('price').value,
                duracion: document.getElementById('duration').value,
                fianza: document.getElementById('deposit').value,
                banderas_rojas: Array.from(document.querySelectorAll('.redflag:checked')).map(e => e.value),
                afiliado: document.getElementById('referral_code').value
            };

            console.log("Enviando configuración (Estilo Crope):", data);

            // Simulación de envío
            // await fetch('/onboarding/save', { method: 'POST', body: JSON.stringify(data)... });

            setTimeout(() => {
                // REDIRECCIÓN (Sin alerts intrusivos, solo fade out)
                window.location.href = 'dashboard.html'; 
            }, 2000);
        }
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <!-- ... (Metadatos intactos) ... -->
    
    <!-- FUENTES Y FRAMEWORK (Alineados con la unificación) -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Muli:wght@300;400;600&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <!-- ESTILOS: EXTERNALIZADOS Y UNIFICADOS -->
    <link href="globals/unified_styles.css" rel="stylesheet">
    
    <!-- Se elimina el bloque <style> completo -->
</head>

<body>
    <!-- ... HEADER COMPATIBLE e HERO BREADCRUMB intactos (asumen unificación CSS) ... -->

    <main>
        <!-- === CALCULATOR AREA === -->
        <section class="container pb-5">
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    
                    <div class="roi-card">
                        
                        <!-- ... (Título y Subtítulo intactos) ... -->

                        <!-- Video Simulado (Intacto salvo el script) -->
                        <div class="video-highlight">
                           <!-- ... (video-highlight contents intactos) ... -->
                        </div>
                        <p id="loading-text" class="text-center text-primary fw-bold" style="display:none; margin-top:-20px; margin-bottom: 20px;">Cargando demostración de la metodología IA...</p>

                        <!-- FORMULARIO DE CÁLCULO -->
                        <form id="calculator" class="mb-5 px-3">
                            
                            <!-- INPUT 1: Pacientes/Mes (Intacto) -->
                            <!-- INPUT 2: Precio Sesión (Intacto) -->
                            
                            <!-- INPUT 3: TASA AUSENTISMO (CORRECCIÓN UX DE COLOR) -->
                            <div class="mb-4">
                                <div class="d-flex justify-content-between align-items-end mb-2">
                                    <label class="fw-bold text-dark text-uppercase small">Tasa Ausentismo (No-Show)</label>
                                    <span class="control-value" id="displayNoShow">8%</span> <!-- ELIMINACIÓN de text-danger -->
                                </div>
                                <input type="range" class="form-range" id="porcentajeNoShow" min="0" max="30" value="8" step="1"> <!-- ELIMINACIÓN de bg-danger -->
                                <div class="mt-2 text-muted small fst-italic">
                                    <i class="fa-solid fa-check-double text-primary me-1"></i> Nuestra IA recupera el 80% de estos huecos. <!-- COLOR DE ACCENTO UNIFICADO -->
                                </div>
                            </div>

                        </form>

                        <!-- CAJA RESULTADOS (Intacta) -->
                        <div class="result-box mb-4">
                            <!-- ... (resultado contents intactos) ... -->
                        </div>

                        <!-- CTA (Botón Unificado) -->
                        <div class="text-center">
                            <a href="onboarding.html" class="cta-button"> <!-- CLASE UNIFICADA (antes theme-btn-2) -->
                                Activar Plan Ahorro <i class="fa-solid fa-arrow-right ms-2"></i>
                            </a>
                            <p class="mt-3 text-muted small">Sin tarjeta requerida para la simulación</p>
                        </div>

                    </div>
                </div>
            </div>
        </section>
    </main>
    
    <!-- ... FOOTER SIMPLE intacto ... -->

    <!-- LÓGICA DE CÁLCULO (JavsScript Vanilla Puro) - REFACTORIZADO LÓGICO -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Referencias DOM (Intactas)
            const inputCitas = document.getElementById('citasMes');
            const displayCitas = document.getElementById('displayCitas');
            
            const inputPrecio = document.getElementById('precioSesion');
            const displayPrecio = document.getElementById('displayPrecio');

            const inputNoShow = document.getElementById('porcentajeNoShow');
            const displayNoShow = document.getElementById('displayNoShow');
            
            const valorAhorro = document.getElementById('valorAhorro');
            
            // Factor Constante de Ahorro por Gestión Ahorrada (CRÍTICO: Lógica de ROI Incompleta)
            // Asumimos un ahorro de 4 minutos de gestión por cita automatizada, valorado a 0.50€/cita.
            const COSTO_AHORRO_GESTION_POR_CITA = 0.75; 
            const PORCENTAJE_EFICACIA_RECUPERACION = 0.80; // Eficacia del Algoritmo (80%)


            // Función Matemática (Actualizada para ROI Completo)
            function calcularROI() {
                // 1. Actualizar textos visuales (UI)
                displayCitas.textContent = inputCitas.value;
                displayPrecio.textContent = inputPrecio.value + ' €';
                displayNoShow.textContent = inputNoShow.value + '%';

                // 2. Variables Numéricas
                const citasMes = parseFloat(inputCitas.value) || 0;
                const precioSesion = parseFloat(inputPrecio.value) || 0;
                const porcentajeNoShow = parseFloat(inputNoShow.value) || 0;
                
                // 3. FÓRMULA DE CÁLCULO AVANZADO (Lógica Incompleta Corregida)
                
                // 3.1. CÁLCULO DE AHORRO POR RECUPERACIÓN DE INGRESOS (el anterior)
                const citasPerdidas = (citasMes * (porcentajeNoShow / 100));
                const citasSalvadas = citasPerdidas * PORCENTAJE_EFICACIA_RECUPERACION;
                const ahorroRecuperacionAnual = (citasSalvadas * precioSesion) * 12;

                // 3.2. CÁLCULO DE AHORRO POR GESTIÓN/TIEMPO LIBERADO (el que faltaba)
                // Se aplica a TODAS las citas, no solo a las salvadas, ya que toda gestión está automatizada
                const ahorroGestionAnual = (citasMes * COSTO_AHORRO_GESTION_POR_CITA) * 12;
                
                const ahorroAnualTOTAL = ahorroRecuperacionAnual + ahorroGestionAnual;

                // 4. Formateo Moneda (Euro) (Intacto: excelente)
                const formatoEuro = new Intl.NumberFormat('es-ES', { 
                    style: 'currency', 
                    currency: 'EUR', 
                    maximumFractionDigits: 0
                });

                valorAhorro.textContent = formatoEuro.format(ahorroAnualTOTAL);
            }

            // Listeners (Intactos)
            inputCitas.addEventListener('input', calcularROI);
            inputPrecio.addEventListener('input', calcularROI);
            inputNoShow.addEventListener('input', calcularROI);

            // Ejecución inicial (Intacta)
            calcularROI();
        });

        // Mock de Video (CRÍTICO: Eliminación de alert() intrusivo)
        function playVideoPresentation() {
            const btn = document.querySelector('.play-video-btn');
            const loading = document.getElementById('loading-text');

            btn.style.transform = "scale(0.8)";
            btn.style.opacity = "0.5";
            loading.style.display = 'block';

            setTimeout(() => {
                // ANTES: alert("Simulación Demo: Aquí se cargaría el video explicativo de la metodología IA.");
                console.log("⏯️ INICIO SIMULACIÓN DEMO: El video se mostraría ahora mismo. Se elimina el ALERT para evitar bloquear la UI.");
                
                // Reset UI
                btn.style.transform = "scale(1)";
                btn.style.opacity = "1";
                loading.style.display = 'none';
            }, 800);
        }
    </script>
 
  </body>
</html>